<?php

namespace App\Http\Fetcher;

use App\Logger;
use App\Models\Settings;
use Carbon\Carbon;
use Illuminate\Support\Facades\Http;

class ClickUpFetcher
{

    const RATE_LIMIT_BOUNDARY = 3;

    public static function getTeam()
    {
        // return json_decode('{"id":"1230141","name":"Zerda Digital\'s Team","color":"#40BC86","avatar":"https://attachments2.clickup.com/team_avatars/6b7d406d-c3b1-402d-b26e-7d2cd5c5341c.blob?Expires=1648684800&Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9hdHRhY2htZW50czIuY2xpY2t1cC5jb20vdGVhbV9hdmF0YXJzLzZiN2Q0MDZkLWMzYjEtNDAyZC1iMjZlLTdkMmNkNWM1MzQxYy5ibG9iIiwiQ29uZGl0aW9uIjp7IkRhdGVMZXNzVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNjQ4Njg0ODAwfX19XX0_&Signature=GVlqO1EqtHlZTgmOcBSZupEDc39VvTDuMhfNuI-kjkiy3OY2xiySFJHj65ZSLlQlyw0VtgTrb85LH5qiEI7MdKfadOl8WAvz8xx88eS~L4QWPTiJ1EuyO2g7LwwLXqj27SyAam-dNOdYaRT8UQgYUiYSnLvYytlnJ1tPfR1CGmFcjJXEomvsSgUWlko5sP70vXyrYywZ3NQppRFtk7od3UVbvWlFvo9geV57SZ7XQ8XvSk58PqguTx9q1t2jliSkWdm~XW04K5iB4-uuksZv0-SazhtwqS4fijh8SRlctGEzqTCcFgOXSKqlLzG5zXdTJMaL4dOzrJCaejQlHsL~Fw__&Key-Pair-Id=APKAIYJRUKB5RLQWHZWQ","members":[{"user":{"id":7310741,"username":"Samir","email":"kachouri.samir@hotmail.com","color":"#02bcd4","profilePicture":null,"initials":"S","role":4,"custom_role":null,"last_active":"1632918513555","date_joined":"1632916441766","date_invited":"1632916356433"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":7294462,"username":"Sabbir ahmed","email":"sabbir25112@gmail.com","color":"#795548","profilePicture":null,"initials":"SA","role":2,"custom_role":null,"last_active":"1633086064159","date_joined":"1632851964988","date_invited":"1632214174317"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":7296213,"username":"Primary Shetu","email":"primary.shetu@gmail.com","color":"#827718","profilePicture":null,"initials":"PS","role":2,"custom_role":null,"last_active":"1632851939470","date_joined":"1632214111702","date_invited":"1632214079619"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":7239479,"username":"Imed El Mokhtar","email":"imed.mokhtar@zerda.digital","color":"#e040fb","profilePicture":"https://attachments.clickup.com/profilePictures/7239479_WS3.jpg","initials":"IM","role":3,"custom_role":null,"last_active":"1633112350925","date_joined":"1629487422387","date_invited":"1629395534632"},"invited_by":{"id":1488092,"username":"Hanna Sebai","color":"#ffa12f","email":"hanna@zerda.digital","initials":"HS","profilePicture":"https://attachments.clickup.com/profilePictures/1488092_21A.jpg"}},{"user":{"id":14810786,"username":"Leo Occhiuzzi","email":"locchiuzzi@canderel.com","color":"#455963","profilePicture":null,"initials":"LO","role":4,"custom_role":null,"last_active":"1624434750327","date_joined":"1621357017757","date_invited":"1621352615762"},"invited_by":{"id":3003777,"username":"Sébastien Sylvestre","color":"#622aea","email":"sebastien@zerda.digital","initials":"SS","profilePicture":null},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":12896082,"username":"Christian Charbonneau","email":"christian.charbonneau@nexafe.com","color":"#aa2fff","profilePicture":null,"initials":"CC","role":4,"custom_role":null,"last_active":"1622212574464","date_joined":"1617300883608","date_invited":"1617299832044"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":12889466,"username":"Sirine Cherif","email":"sirine.cherif@zerda.digital","color":"#afb42b","profilePicture":"https://attachments.clickup.com/profilePictures/12889466_Z5e.jpg","initials":"SC","role":4,"custom_role":null,"last_active":"1633272143617","date_joined":"1617273733742","date_invited":"1617101776219"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":8809812,"username":"salsabil","email":"salsabil.najjar@zerda.digital","color":"#e040fb","profilePicture":null,"initials":"S","role":3,"custom_role":null,"last_active":"1633126308238","date_joined":"1614596535506","date_invited":"1614349506305"},"invited_by":{"id":1488092,"username":"Hanna Sebai","color":"#ffa12f","email":"hanna@zerda.digital","initials":"HS","profilePicture":"https://attachments.clickup.com/profilePictures/1488092_21A.jpg"}},{"user":{"id":8726812,"username":"Ines Sakkat","email":"ines.sakkat@zerda.digital","color":"#0388d1","profilePicture":null,"initials":"IS","role":3,"custom_role":null,"last_active":"1633079680275","date_joined":"1612179202048","date_invited":"1612166055967"},"invited_by":{"id":1370944,"username":"Mahmoud Ben Aissa","color":"#3e2724","email":"mahmoud@zerda.digital","initials":"MA","profilePicture":"https://attachments.clickup.com/profilePictures/1370944_rRK.jpeg"}},{"user":{"id":10705226,"username":"Dominique Gauthier","email":"dominique@zerda.digital","color":"#5f81ff","profilePicture":null,"initials":"DG","role":4,"custom_role":null,"last_active":"1623263631126","date_joined":"1603294993732","date_invited":"1603287558873"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":6647148,"username":"Younes Yahmed","email":"younes.yahmed@zerda.digital","color":"#3e2724","profilePicture":null,"initials":"YY","role":3,"custom_role":null,"last_active":"1633086237756","date_joined":"1603279454189","date_invited":"1603279008345"},"invited_by":{"id":1370944,"username":"Mahmoud Ben Aissa","color":"#3e2724","email":"mahmoud@zerda.digital","initials":"MA","profilePicture":"https://attachments.clickup.com/profilePictures/1370944_rRK.jpeg"}},{"user":{"id":10640364,"username":"Ahmed Nabli","email":"ahmed.nabli@zerda.store","color":"#ff7fab","profilePicture":"https://attachments.clickup.com/profilePictures/10640364_0Xt.jpg","initials":"AN","role":4,"custom_role":null,"last_active":"1633124562084","date_joined":"1600708940690","date_invited":"1600656932358"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":true,"can_edit_tags":false},{"user":{"id":6319204,"username":"Bernie Ann Busico","email":"bernie.busico@zerda.store","color":"#0ab4ff","profilePicture":null,"initials":"BB","role":4,"custom_role":null,"last_active":"1632969298800","date_joined":"1589411244894","date_invited":"1589409027334"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":false},{"user":{"id":6309979,"username":"Ouss","email":"romdhaneoussama2@gmail.com","color":"#7b68ee","profilePicture":"https://attachments.clickup.com/profilePictures/6309979_39k.jpg","initials":"O","role":4,"custom_role":null,"last_active":"1606164127332","date_joined":"1588863186398","date_invited":"1588862485202"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":false},{"user":{"id":4553193,"username":"Khouloud Bentardeit","email":"khouloud.bentardeit@zerda.digital","color":"#622aea","profilePicture":"https://attachments.clickup.com/profilePictures/4553193_f9W.jpg","initials":"KB","role":3,"custom_role":null,"last_active":"1633113576222","date_joined":"1583770829039","date_invited":"1583752553714"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":4417144,"username":"Mokrnai ilyes","email":"ilyess.mokrani@zerda.digital","color":"#02579b","profilePicture":null,"initials":"MI","role":4,"custom_role":null,"last_active":"1633285914408","date_joined":"1582550971863","date_invited":"1582544762524"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":false},{"user":{"id":4395133,"username":"Oumaima","email":"oumaima.belatteg@zerda.digital","color":"#07a092","profilePicture":null,"initials":"O","role":4,"custom_role":null,"last_active":"1633284320968","date_joined":"1580890134839","date_invited":"1580874606142"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":true},{"user":{"id":4368111,"username":"Amal Becha","email":"amal@zerda.digital","color":"#d60800","profilePicture":"https://attachments.clickup.com/profilePictures/4368111_hRd.jpg","initials":"AB","role":4,"custom_role":null,"last_active":"1633091690554","date_joined":"1578909505744","date_invited":"1578888050854"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":true},{"user":{"id":2439715,"username":"Emna  zribi","email":"emna@zerda.digital","color":"#795548","profilePicture":null,"initials":"EZ","role":4,"custom_role":null,"last_active":"1633184538043","date_joined":"1572606683250","date_invited":"1572604064385"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":true},{"user":{"id":4232288,"username":"Ali Gassab","email":"ali@zerda.store","color":"#0197a7","profilePicture":null,"initials":"AG","role":4,"custom_role":null,"last_active":"1633087945725","date_joined":"1570018787416","date_invited":"1565577919907"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":false},{"user":{"id":3003777,"username":"Sébastien Sylvestre","email":"sebastien@zerda.digital","color":"#622aea","profilePicture":null,"initials":"SS","role":3,"custom_role":null,"last_active":"1633286042307","date_joined":"1564932088922","date_invited":"1564931800879"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":4203041,"username":"Nabil","email":"nabil@zerda.digital","color":"#08c7e0","profilePicture":null,"initials":"N","role":4,"custom_role":null,"last_active":"1633038291921","date_joined":"1562100823188","date_invited":"1562100745667"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":true},{"user":{"id":4201340,"username":"Amira Br","email":"amira@zerda.digital","color":"#757380","profilePicture":"https://attachments.clickup.com/profilePictures/4201340_4bc.jpg","initials":"AB","role":4,"custom_role":null,"last_active":"1617692383650","date_joined":"1561979850785","date_invited":"1561978947759"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"},"can_see_time_spent":true,"can_see_time_estimated":true,"can_see_points_estimated":null,"can_edit_tags":false},{"user":{"id":1488092,"username":"Hanna Sebai","email":"hanna@zerda.digital","color":"#ffa12f","profilePicture":"https://attachments.clickup.com/profilePictures/1488092_21A.jpg","initials":"HS","role":2,"custom_role":null,"last_active":"1633024220226","date_joined":"1560774776186","date_invited":"1560737899900"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":313190,"username":"Samir Kachouri","email":"samir@zerda.digital","color":"#f42c2c","profilePicture":"https://attachments.clickup.com/profilePictures/313190_1R8.jpg","initials":"SK","role":3,"custom_role":null,"last_active":"1633018100703","date_joined":"1552479583875","date_invited":"1552336706277"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":1394007,"username":"Haithem Laabidi","email":"htm@zerda.digital","color":"#202020","profilePicture":"https://attachments.clickup.com/profilePictures/1394007_Yq8.jpeg","initials":"HL","role":2,"custom_role":null,"last_active":"1633102170709","date_joined":"1547793318882","date_invited":"1547060145784"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":1370944,"username":"Mahmoud Ben Aissa","email":"mahmoud@zerda.digital","color":"#3e2724","profilePicture":"https://attachments.clickup.com/profilePictures/1370944_rRK.jpeg","initials":"MA","role":2,"custom_role":null,"last_active":"1633266021221","date_joined":"1546351505632","date_invited":"1539869270961"},"invited_by":{"id":1370941,"username":"Chiheb Ben Aissa","color":"#02bcd4","email":"chiheb@zerda.digital","initials":"CA","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg"}},{"user":{"id":1370941,"username":"Chiheb Ben Aissa","email":"chiheb@zerda.digital","color":"#02bcd4","profilePicture":"https://attachments.clickup.com/profilePictures/1370941_Bm8.jpeg","initials":"CA","role":1,"custom_role":null,"last_active":"1633115681621","date_joined":"1539869270961","date_invited":"1539869270961"}}]}', true);
        $settings = Settings::clickup();
        $access_token = $settings->access_token;

        $api = env('CLICK_UP_BASE_URL') . '/team';

        $request = Http::withHeaders([
            'Authorization' => $access_token
        ])->get($api);

        if ($request->header('X-RateLimit-Remaining') < self::RATE_LIMIT_BOUNDARY) {
            $resetTime = Carbon::createFromTimestamp($request->header('X-Ratelimit-Reset'));
            $willBeBackIn = $resetTime->toDateTimeString();
            Logger::verbose("RATE LIMIT BOUNDARY CROSSED. WILL RESUME IN $willBeBackIn");
            sleep($resetTime->diffInSeconds() + 1);
        }

        if ($request->successful()) {
            $response = $request->json();
            $teams = $response['teams'] ?? [];
            return $teams[0] ?? [];
        }
        return [];
    }

    public static function getSpaces($teamId)
    {
        // return json_decode('[{"id":"2228742","name":"Zerda Team","private":false,"statuses":[{"id":"p2228742_z8Ljgda4","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2228742_qFBEAKmp","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p2228742_xB6RwhuG","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p2228742_v4VK85st","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p2228742_6ZZ88ZjV","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":true,"checklists":false,"comments":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2299871","name":"Beauty Route","private":false,"statuses":[{"id":"p2299871_1sTBoF5M","status":"Open","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2299871_FPEQzKo6","status":"repetitive","type":"custom","orderindex":1,"color":"#50e3c2"},{"id":"p2299871_3RdUU5bk","status":"planned","type":"custom","orderindex":2,"color":"#f81c07"},{"id":"p2299871_x5ERmaiL","status":"in progress","type":"custom","orderindex":3,"color":"#ff00df"},{"id":"p2299871_hPaU0Nl1","status":"test","type":"custom","orderindex":4,"color":"#7b68ee"},{"id":"p2299871_NO2htSFu","status":"ready for launch","type":"custom","orderindex":5,"color":"#ffcf00"},{"id":"p2299871_pNJue4sg","status":"live & review","type":"custom","orderindex":6,"color":"#333"},{"id":"p2299871_NbCFre7H","status":"Closed","type":"closed","orderindex":7,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2319938","name":"TrackTik","private":false,"statuses":[{"id":"p2319938_jL97qcBv","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2319938_GIeWxIR3","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p2319938_7EW8UlJ7","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p2319938_LiRedG3N","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p2319938_7j3TBPyy","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":true},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"1303438","name":"Store Traffic","private":false,"statuses":[{"id":"p1303438_8b3rawRL","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p1303438_4NBtWl1M","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p1303438_aPAHcn9f","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p1303438_at5wj9mV","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p1303438_dUyEiL87","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":true,"checklists":false,"comments":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2417910","name":"Darkhorse Rowing","private":false,"statuses":[{"id":"p2417910_IFAIgjuH","status":"Open","type":"open","orderindex":0,"color":"#aeacb0"},{"id":"p2417910_XCH7GPKC","status":"pending","type":"custom","orderindex":1,"color":"#fc0"},{"id":"p2417910_Eg9x98xP","status":"in progress","type":"custom","orderindex":2,"color":"#ff540d"},{"id":"p2417910_zin17S1h","status":"completed","type":"custom","orderindex":3,"color":"#000"},{"id":"p2417910_EbwQVPWq","status":"in review","type":"custom","orderindex":4,"color":"#f90"},{"id":"p2417910_u0f0wPV4","status":"accepted","type":"custom","orderindex":5,"color":"#f81c07"},{"id":"p2417910_1vQ3Ik20","status":"rejected","type":"custom","orderindex":6,"color":"#ff00df"},{"id":"p2417910_RLuXGMQx","status":"blocked","type":"custom","orderindex":7,"color":"#a875ff"},{"id":"p2417910_oZYyrSoM","status":"Closed","type":"closed","orderindex":8,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2228678","name":"Small Projects","private":false,"statuses":[{"id":"p2228678_O8P4r4YW","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2228678_pyYlUNWG","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p2228678_Khmq29xY","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p2228678_RgMBmAso","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p2228678_qcy9zyay","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":true,"checklists":false,"comments":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2455958","name":"Forma","private":false,"statuses":[{"id":"p2455958_h0EQBuJd","status":"Open","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2455958_LJABYHSZ","status":"pending","type":"custom","orderindex":1,"color":"#FFCC00"},{"id":"p2455958_APuFqCKt","status":"in progress","type":"custom","orderindex":2,"color":"#FF540D"},{"id":"p2455958_Wu7tiDRN","status":"completed","type":"custom","orderindex":3,"color":"#000000"},{"id":"p2455958_rhEH3OXO","status":"in review","type":"custom","orderindex":4,"color":"#ff9900"},{"id":"p2455958_mk9WWNx5","status":"accepted","type":"custom","orderindex":5,"color":"#F81C07"},{"id":"p2455958_CVZgNksv","status":"rejected","type":"custom","orderindex":6,"color":"#FF00DF"},{"id":"p2455958_BWHqGmU9","status":"blocked","type":"custom","orderindex":7,"color":"#A875FF"},{"id":"p2455958_ohr8qcTo","status":"Closed","type":"closed","orderindex":8,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"4339556","name":"NeXafe","private":false,"statuses":[{"id":"p4339556_UVqkUbCm","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p4339556_ru0Pi0Us","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p4339556_DWcopUXd","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p4339556_lCzgZyw0","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p4339556_01cX6mMz","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":true},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":true,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":true},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"2692879","name":"Client X","private":false,"statuses":[{"id":"p2692879_493FnQL5","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p2692879_K3rc3Oo5","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p2692879_kEV4n2u5","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p2692879_jOcaR0jQ","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p2692879_3UH7xqnz","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":false,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"4539313","name":"Jumpland Group","private":false,"statuses":[{"id":"p4539313_p2692879_493FnQL5","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p4539313_p2692879_K3rc3Oo5","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p4539313_4of0IT1C","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p4539313_p2692879_jOcaR0jQ","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p4539313_p2692879_3UH7xqnz","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":true},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"10543973","name":"VideoHUB","private":false,"statuses":[{"id":"p10543973_qM2MIDGF","status":"to do","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p10543973_W9ZjuBiF","status":"complete","type":"closed","orderindex":1,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"10736677","name":"Canderel","private":false,"statuses":[{"id":"p10736677_RgrJN1MH","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p10736677_RP9u2bsx","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p10736677_M6fwJlm5","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p10736677_4kAiKcEk","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p10736677_NLpaOVp5","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"10757771","name":"Cobalt","private":false,"statuses":[{"id":"p10757771_5eV19H7y","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p10757771_IRJBRNLi","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p10757771_rUvjlGAw","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p10757771_Wv7SAGYO","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p10757771_F3IEENWD","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"14796495","name":"Solutions Composites","private":false,"statuses":[{"id":"p14796495_0nyXbH4e","status":"Open","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p14796495_I57QLfLu","status":"pending","type":"custom","orderindex":1,"color":"#fc0"},{"id":"p14796495_dkCkm7YS","status":"in progress","type":"custom","orderindex":2,"color":"#ff540d"},{"id":"p14796495_hovvDTex","status":"blocked","type":"custom","orderindex":3,"color":"#a875ff"},{"id":"p14796495_bIyr4cXB","status":"in review","type":"custom","orderindex":4,"color":"#f90"},{"id":"p14796495_BQO7c1EE","status":"Closed","type":"closed","orderindex":5,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"6602892","name":"HelioVR","private":false,"statuses":[{"id":"p6602892_i8dRRVol","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p6602892_AeNySS03","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p6602892_j2RrRHVK","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p6602892_OedtoN9z","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p6602892_NvC6pT9t","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"5964700","name":"Gama IQ","private":false,"statuses":[{"id":"p5964700_p2692879_493FnQL5","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p5964700_p2692879_K3rc3Oo5","status":"standby","type":"custom","orderindex":1,"color":"#e50000"},{"id":"p5964700_p2692879_kEV4n2u5","status":"to do","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p5964700_p2692879_jOcaR0jQ","status":"in progress","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p5964700_p2692879_3UH7xqnz","status":"Closed","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":false,"remap_closed_due_date":false},"sprints":{"enabled":false},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":true},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"19201202","name":"Bonne Maman","private":false,"statuses":[{"id":"p19201202_65hiOnJT","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p19201202_AneQhpgn","status":"standby","type":"custom","orderindex":1,"color":"#f9d900"},{"id":"p19201202_FbZkunAj","status":"in progress","type":"custom","orderindex":2,"color":"#3397dd"},{"id":"p19201202_u1TLpjV4","status":"Closed","type":"closed","orderindex":3,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"18306105","name":"Agile Management (Full)","private":false,"statuses":[{"id":"p18306105_p5874101_p5874023_p14790396_p6723775_p6689846_p4622083_p4622082_p4558520_p4547691_Nu9HGk0n","status":"to do","type":"open","orderindex":0,"color":"#667684"},{"id":"p18306105_p5874101_p5874023_p14790396_p6723775_p6689846_p4622083_p4622082_p4558520_p4547691_1uWhldX3","status":"pending","type":"custom","orderindex":1,"color":"#fc0"},{"id":"p18306105_p5874101_p5874023_p14790396_p6723775_p6689846_p4622083_p4622082_p4558520_p4547691_W6nYbHky","status":"in progress","type":"custom","orderindex":2,"color":"#ff7800"},{"id":"p18306105_p5874101_p5874023_p14790396_p6723775_p6689846_p4622083_p4622082_p4558520_p4547691_yT8fpsRa","status":"in review","type":"custom","orderindex":3,"color":"#3397dd"},{"id":"p18306105_p5874101_p5874023_p14790396_p6723775_p6689846_p4622083_p4622082_p4558520_p4547691_Z9RuIXWN","status":"done","type":"closed","orderindex":4,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":false,"remap_closed_due_date":false},"sprints":{"enabled":true},"points":{"enabled":true},"custom_items":{"enabled":false},"tags":{"enabled":true},"wip_limits":{"enabled":true},"check_unresolved":{"enabled":true,"subtasks":true,"checklists":true,"comments":true},"zoom":{"enabled":true},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"18306117","name":"Sollum Technologies","private":false,"statuses":[{"id":"p18306117_gskyPGAK","status":"Open","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p18306117_cKFgTkbF","status":"pending","type":"custom","orderindex":1,"color":"#FFCC00"},{"id":"p18306117_Ebis6UKp","status":"in progress","type":"custom","orderindex":2,"color":"#FF540D"},{"id":"p18306117_9VB67S8L","status":"in review","type":"custom","orderindex":3,"color":"#ff9900"},{"id":"p18306117_4JjDX6dP","status":"completed","type":"custom","orderindex":4,"color":"#000000"},{"id":"p18306117_rA1liKGR","status":"Closed","type":"closed","orderindex":5,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"19239375","name":"Restaurant La Capital","private":false,"statuses":[{"id":"p19239375_Dd5Z0nXI","status":"backlog","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p19239375_qUQkqVGo","status":"standby","type":"custom","orderindex":1,"color":"#f9d900"},{"id":"p19239375_GpWOwJgh","status":"in progress","type":"custom","orderindex":2,"color":"#3397dd"},{"id":"p19239375_XD4ca8Bl","status":"Closed","type":"closed","orderindex":3,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":false},"custom_fields":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"24622489","name":"HCL Tech","private":false,"statuses":[{"id":"p24622489_okR8608O","status":"Open","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p24622489_BhXlghc1","status":"pending","type":"custom","orderindex":1,"color":"#FFCC00"},{"id":"p24622489_z0Ya12yV","status":"in progress","type":"custom","orderindex":2,"color":"#FF540D"},{"id":"p24622489_kkPDEMlN","status":"in review","type":"custom","orderindex":3,"color":"#ff9900"},{"id":"p24622489_nJJVCt9s","status":"completed","type":"custom","orderindex":4,"color":"#000000"},{"id":"p24622489_a0jcH68f","status":"Closed","type":"closed","orderindex":5,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":true},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"20193664","name":"Mitelman Properties","private":false,"statuses":[{"id":"p20193664_U4PiFYIR","status":"to do","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p20193664_VerI9Lkh","status":"done","type":"done","orderindex":1,"color":"#9E185F"},{"id":"p20193664_UwPIFr4Z","status":"Closed","type":"closed","orderindex":2,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":true},"time_tracking":{"enabled":true,"harvest":false,"rollup":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"time_estimates":{"enabled":true,"rollup":false,"per_assignee":false},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false},{"id":"20203877","name":"Espace Client Space","private":false,"statuses":[{"id":"p20203877_tSZxb6ui","status":"to do","type":"open","orderindex":0,"color":"#d3d3d3"},{"id":"p20203877_FSapp7zn","status":"in progress","type":"custom","orderindex":1,"color":"#53E231"},{"id":"p20203877_04hHvR0w","status":"done","type":"done","orderindex":2,"color":"#E65100"},{"id":"p20203877_Z60IzxAt","status":"Closed","type":"closed","orderindex":3,"color":"#6bc950"}],"multiple_assignees":true,"features":{"due_dates":{"enabled":true,"start_date":true,"remap_due_dates":true,"remap_closed_due_date":false},"sprints":{"enabled":false},"points":{"enabled":false},"custom_items":{"enabled":false},"priorities":{"enabled":true,"priorities":[{"id":"1","priority":"urgent","color":"#f50000","orderindex":"1"},{"id":"2","priority":"high","color":"#ffcc00","orderindex":"2"},{"id":"3","priority":"normal","color":"#6fddff","orderindex":"3"},{"id":"4","priority":"low","color":"#d8d8d8","orderindex":"4"}]},"tags":{"enabled":true},"check_unresolved":{"enabled":true,"subtasks":null,"checklists":null,"comments":null},"zoom":{"enabled":false},"milestones":{"enabled":true},"custom_fields":{"enabled":true},"remap_dependencies":{"enabled":true},"dependency_warning":{"enabled":true},"multiple_assignees":{"enabled":true},"emails":{"enabled":true}},"archived":false}]', true);

        $settings = Settings::clickup();
        $access_token = $settings->access_token;

        $api = env('CLICK_UP_BASE_URL') . '/team/' . $teamId . '/space';
        $request = Http::withHeaders([
            'Authorization' => $access_token
        ])->get($api);

        if ($request->header('X-RateLimit-Remaining') < self::RATE_LIMIT_BOUNDARY) {
            $resetTime = Carbon::createFromTimestamp($request->header('X-Ratelimit-Reset'));
            $willBeBackIn = $resetTime->toDateTimeString();
            Logger::verbose("RATE LIMIT BOUNDARY CROSSED. WILL RESUME IN $willBeBackIn");
            sleep($resetTime->diffInSeconds() + 1);
        }

        if ($request->successful()) {
            $response = $request->json();
            return $response['spaces'] ?? [];
        }
        return [];
    }

    public static function getFolders($spaceId)
    {
        $settings = Settings::clickup();
        $access_token = $settings->access_token;

        $api = env('CLICK_UP_BASE_URL') . "/space/$spaceId/folder";

        $request = Http::withHeaders([
            'Authorization' => $access_token
        ])->get($api);

        if ($request->header('X-RateLimit-Remaining') < self::RATE_LIMIT_BOUNDARY) {
            $resetTime = Carbon::createFromTimestamp($request->header('X-Ratelimit-Reset'));
            $willBeBackIn = $resetTime->toDateTimeString();
            Logger::verbose("RATE LIMIT BOUNDARY CROSSED. WILL RESUME IN $willBeBackIn");
            sleep($resetTime->diffInSeconds() + 1);
        }

        if ($request->successful()) {
            $response = $request->json();
            return $response['folders'] ?? [];
        }
        return [];
    }

    public static function getTasks($listId, $max_page = 0)
    {
        $settings = Settings::clickup();
        $access_token = $settings->access_token;

        $api = env('CLICK_UP_BASE_URL') . "/list/$listId/task";
        $final_response = [];

        for ($page = 0; $page <= $max_page; $page++)
        {
            Logger::verbose("fetching page $page for listId: $listId");

            $request = Http::withHeaders([
                'Authorization' => $access_token
            ])->get($api, [
                'page'      => $page,
                'subtasks'  => true
            ]);

            if ($request->header('X-RateLimit-Remaining') < self::RATE_LIMIT_BOUNDARY) {
                $resetTime = Carbon::createFromTimestamp($request->header('X-Ratelimit-Reset'));
                $willBeBackIn = $resetTime->toDateTimeString();
                Logger::verbose("RATE LIMIT BOUNDARY CROSSED. WILL RESUME IN $willBeBackIn");
                sleep($resetTime->diffInSeconds() + 1);
            }

            if ($request->successful()) {
                $response = $request->json();
                $tasks = $response['tasks'] ?? [];
                $final_response = array_merge($final_response, $tasks);
            }
        }

        return $final_response;
    }
}
